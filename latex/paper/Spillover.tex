\documentclass[11pt]{article}

\title{Difference-in-Differences with Spatial Spillovers\thanks{I am grateful to Taylor Jaworski, Adam McCloskey, Brantly Callaway, Pedro Sant'Anna, Damian Clarke, Daniel Kaffine, Tania Barham, Alexander Bentz, James Flynn, Brach Champion, Hannah Denker, the CU Boulder Labor Economics Seminar, the Urban Economics Association Conference, the WEAI Conference, and the University of Rochester HEEL Lab for helpful comments.}}
\author{\href{https://kylebutts.com/}{Kyle Butts}\thanks{University of Colorado Boulder, Economics Department (\href{mailto:kyle.butts@colorado.edu}{kyle.butts@colorado.edu})}}
\date{\today}

\input{preamble.tex}

\hypersetup{
    pdftitle={Difference-in-Differences Estimation with Spatial Spillovers},    pdfauthor={Kyle Butts}
}

\begin{document}

% ------------------------------------------------------------------------------
\begin{titlepage}
    \maketitle

    \begin{abstract}
        {\small
        Empirical work often uses treatment assigned following geographic boundaries. When the effects of treatment cross over borders, classical difference-in-differences estimation produces biased estimates for the average treatment effect. In this paper, I introduce a potential outcomes framework to model spillover effects and decompose the estimate's bias in two parts: (1) the control group no longer identifies the counterfactual trend because their outcomes are affected by treatment and (2) changes in treated units' outcomes reflect the effect of their own treatment status and the effect from the treatment status of ``close'' units. I propose estimation strategies that can remove both sources of bias and semi-parametrically estimate the spillover effects themselves including in settings with staggered treatment timing. To highlight the importance of spillover effects, I revisit analyses of three place-based interventions.
    
        \par~\par\noindent
        \noindent{\color{asher} JEL Classification Number:} C01, C21, C23, R15, R58
        \par
        \noindent{\color{asher} Keywords:} difference-in-differences, spatial econometrics, spillover effects, causal inference, place-based interventions
        \par\vspace{-2.5mm}
        }
    \end{abstract}
\end{titlepage}
% ------------------------------------------------------------------------------



% ------------------------------------------------------------------------------
\section{Introduction}
% ------------------------------------------------------------------------------

Empirical work in economics often considers settings where a policy is targeted to groups of units defined by geographic boundaries, but the effect of treatment spills over onto `nearby' units.\footnote{The framework of this paper applies to any setting with a well-defined measures of distance, e.g. geographic distance, economic distance such as supply chains, node distance in a graph, or social relationships in schools or cities.} For example, individuals in control areas can travel to the treated areas and receive treatment (e.g. a hospital opening serves nearby residents), or shocks to a labor market can affect nearby areas (e.g. a new factory opening increases service sector spending in the entire commuting zone). For other treated units, the treatment effect can depend on other units' treatment status. Forces of agglomeration can increase effect size as treatment concentration increases (e.g. knowledge-sharing between firms) or forces of congestion/competition can decrease the effects of treatment (e.g. bidding up of wages causes the employment effects of factory openings to be mitigated). 

In this paper, I introduce a potential outcomes framework that directly models spillover effects and use this model to derive identification results in difference-in-differences settings. Using this potential outcome framework, I define different possible treatment effects of interest, discuss their interpretation, and show which effects are non-parametrically identified. 

First, there is the `switching effect' which is the relevant parameter for local policymakers who want to answer ``What is the effect of switching my treatment status, holding fixed all other units' treatment?''. It is difficult to estimate the switching effect without parametric assumptions on spillovers. The reason for this is that the magnitude of the switching effect potentially depends on the treatment status of a unit's neighbors. For example, the construction of low-cost medical facilities will have larger treatment effects when neighboring areas do not have facilities. Switching effects therefore are defined separately for each level of exposure and estimation of the effect at a particular level requires knowledge of which control units experience the same level of exposure. I show that identification therefore requires \emph{either} parametrization of spillovers \emph{or} certain constraints on the homogeneity of spillover effects. While the switching effect is not identified nonparametrically in general, the switching effect for units with zero exposure is identified under mild assumptions. I call this effect the `direct effect' which measures the effects of turning on a unit's treatment if they were the \emph{only} unit to be treated in their general area. 

The second effect of interest is the `total effect' which is the relevant parameter for national policymakers who want to answer ``What is the average effect of implementing the entire treatment regime?''. This treatment effect summarizes the post-hoc effects of going from the world with no treatment to the observed treatment vector. This effect comes from two sources: the direct effect on each treated unit and the average spillover effect on to treated units from other treated units. 

This paper then defines conditions under which the direct and total effects are nonparametrically identified by a modified difference-in-differences type estimand under a mild assumption that spillovers are `local' in nature. The local spillovers assumption holds in the case where spillover effects are only experienced by units within a certain distance of treated units. This would hold in the case where individuals can travel to access treatment and therefore spillovers are limited by travel costs. However, this would fail in the case of large general equilibrium shocks that cause units far away to be affected by treatment (e.g. San Francisco being affected by shocks to the New York economy).

Next, I assess the commonly used difference-in-differences estimate. This paper shows that the difference-in-differences estimator is a biased estimate for the direct and the total effect. This bias arises because untreated units that are `close' to treated units experience effects of treatment and therefore these `control' units fail to identify the counterfactual trend. Difference-in-differences estimates average the spillover onto the `close' control units into the untreated units' change in outcomes. Hence, the spillover is subtracted from the estimated treatment effect and biases the estimate in the opposite sign of the spillover effect. For example, if nearby control units also benefit from treatment, then researchers would underestimate the treatment effect of the treated. The direct effect also has a second source of bias because changes in treated units' outcomes reflect the effect of their own treatment status and the effect from the treatment status of `close' units. In difference-in-differences, the spillover onto other treated units is averaged into the treated units' change in outcomes. Therefore the bias on the direct effect estimate is the same sign as the sign of the spillover. 

Under the assumption that spillovers are local, I formalize the identification argument used in a common adjustment of including an indicator for being affected by spillovers (or removing them from the sample) in the two-way fixed-effects model. I show, under mild assumptions, that this method will remove \emph{all bias} from the treatment effect estimate so long as the indicator captures all units affected by spillovers. The bias term in the difference-in-differences estimate for the total effect is the \textit{average} spillover effects onto control units. An indicator variable that contains \emph{all} control units affected by spillover can therefore remove this bias. However, adding this indicator changes the underlying control group to the control units not included in the indicator variable and hence a researcher must justify why this subsample will form a valid control group for the parallel trends assumption. When estimating the direct effect, a second indicator variable containing \emph{all} treated units affected by spillovers can remove the second source of bias. Similar to the control group indicator, this modifies the treatment group over which the average treatment group is taken (those with indicator equal to zero). Importantly, my method does not require researchers to make any assumptions about how spillover effects propagate across space. The primary assumption required is selecting the maximum distance from treated units that spillovers can occur.\footnote{Since treatment effects typically decay over distance, this is not a strong assumption. Even if the maximum distance is not large enough, most of the bias will still be removed. On the other hand, making the maximum distance too large will increase the variance in the estimates as there are fewer remaining control units to identify the parallel counterfactual unit.} 

The modified difference-in-differences framework with an added spillover indicator provides a poor estimate of spillover effects. The estimate averages spillover effects over all units with the indicator equal to 1 which can include units that are unaffected by spillovers. Therefore the estimate will be attenuated to zero. The above method can be improved by creating a set of distance bins from the treated units (e.g. being 0-20 miles, 20-40 miles, 40-60 miles from the treated units) and interacting them with a treatment indicator.\footnote{The choice of the distance bins depends on the economic context and in particular the source of the spillovers. In some cases, the bins can be determined in a data-driven way \citep{Butts_2021}.} Since a set of `rings' is collinear with a single indicator covering the bins, this estimator consistently estimates the treatment effect of interest. This estimator has the added benefit that each indicator will estimate the average spillover effect on treated/control units within that distance range which provides a more complete picture of which units are affected by treatment and at what magnitude. 

To show the importance of considering spillover effects and the utility of my estimators, I revisit analyses of place-based policies in urban economics in Section \ref{sec:tva}. I revisit the analysis of the Tennessee Valley Authority by \citet{Kline_Moretti_2014}. The Tennessee Valley Authority was a large-scale New Deal program that lowered the cost of power for industrial firms \citep{Kitchens_2014}. The scale of federal investment in the region was large and the pro-manufacturing benefits likely spread further than the Authority's boundary due to the electrification infrastructure and agglomeration economies \citep{Severnini_2014}. I show that estimation by difference-in-differences fails to account for these spillovers and therefore the authors obtain biased estimates of the total effect of the Tennessee Valley Authority. For agriculture employment, I find that the long-run spillovers cause the original estimates to be about 40 percent too small for agriculture employment and 40 percent too large for manufacturing employment.
% (-0.0739 - -0.0514) / (-0.0514) = 43.7\% increase
% (0.0350 - 0.0560) / (0.0560) = 37.5\% decrease

Following this empirical application, I discuss how my framework fits into a larger discussion on identification strategies with place-based policies. I revisit conflicting results about United States' federal Empowerment Zones, a program that creates incentives for businesses to locate in high-poverty neighborhoods. States apply for Empowerment Zone status for areas that meet a list of requirements but due to limited funding, not all proposed areas were accepted. \citet{Busso_Gregory_Kline_2013} use Census Tracts from qualified but ultimately rejected applications that are typically far away from accepted Zones as a comparison group and find significant reductions in poverty. This empirical strategy is based on the idea that since they also qualified for the program, these comparison units would be on parallel trends without being contaminated by spillover effects from treatment. \citet{Neumark_Kolko_2010}, on the other hand, use census tracts within 1,000 feet of the Zone and find no statistically significant effects. This empirical strategy assumes that the borders are drawn somewhat randomly and therefore units being just outside will have parallel counterfactual trends. Although, the trade-off is that using close units is potentially problematic as they can experience spillover effects from the Zones. My framework can explain the differences in findings if there are positive spillover effects onto census tracts just outside Empowerment Zones. In appendix \ref{sec:oz}, I show an example of the importance in considering spillovers when chosing identification strategy by analyzing the effects of the 2017 Opportunity Zone place-based policy.

Last, in Section \ref{sec:event_study}, I extend estimation of the direct effect and spillover effects of treatment into the TWFE/event-study framework by extending the work of \citet{Gardner_2021}. This allows for a very common setting in which treatment turns on for different units in different periods. Their proposed two-stage estimator first estimates group and time fixed-effects using untreated/not-yet-treated observations. Since some control/not-yet-treated units can be affected by spillovers, these units must be removed to consistently estimate the group and time fixed-effects. Then these estimated unit and time fixed-effects are subtracted from the observed outcome \emph{in the full sample}. The resulting residuals are then regressed on the treatment and spillover variables to estimate treatment and spillover effects. In the online appendix, I demonstrate the method by revisiting the analysis by \citet{Bailey_Goodman_Bacon_2015} of Community Health Centers which provided low-cost primary care to impoverished areas.

% ------------------------------------------------------------------------------
\subsection{Relation to the Literature} 
% ------------------------------------------------------------------------------

I contribute to the literature that focuses on estimation of treatment effects with spatial spillovers using the difference-in-differences framework in three ways \citep{Clarke_2017,Berg_Streitz_2019,Verbitsky-Savitz_Raudenbush_2012,Delgado_Florax_2015}. My paper is the first to consider identification in terms of general potential outcomes. Other papers derive results for specific spillover mappings. If I assume the particular functional forms for potential outcomes, I arrive at the same bias equation as theirs. The literature has focused on estimating the total effect, so I further contribute by discussing alternative treatment effect estimates and identification results. Last, my paper also advances the literature by considering estimation of direct effects and spillover effects in the event-study framework which allows for the common occurrence of staggered treatment adoption.

This paper relates to a broad literature on spillover effect estimation in randomized experiments.\footnote{See \citet{Sobel_2006} and \citet{Hudgens_Halloran_2008} for early work. See \citet{Hu_Li_Wager_2021}, \citet{Savje_Aronow_Hudgens_2021}, and \citet{Vazquez-Bare_2019} and references therein for recent work on this.} There are two main strands of this literature. First, there is a large literature on the estimation of treatment effects in the presence of spillovers using a `partial identification' framework where units are in distinct treatment clusters and outcomes depend on the treatment status within the observation's cluster only.\footnote{ \citet{Angelucci_DiMaro_2016} provides an overview of estimation of treatment effects in the presence of ``within-group'' spillovers. Examples in the literature include: \citet{Halloran_Struchiner_1995} consider community-vaccine rates in epidemiology; \citet{Miguel_Kremer_2004} consider deworming programs in Kenyan schools; \citet{Sobel_2006} considers interference in the Moving to Opportunity Program; and \citet{Angrist_2014} studies the context of school peer effects.} Estimation compares units in the partially treated clusters with control units in completely untreated clusters which do not receive spillover effects. This allows standard difference-in-differences estimation of both the total effect (treatment effect on the treated) and spillover effects (treatment effect on the untreated in the treated clusters). However, in many settings distinct clusters are not plausible, e.g. counties near the border of a state can affect each other. My proposed estimator generalizes this method by using control units that are unaffected by treatment without requiring a notion of clusters.

There is also a nascent literature exploring estimation of direct and spillover effects which does not require a completely untreated cluster in experimental settings (\citet{Savje_Aronow_Hudgens_2021}, \citet{Vazquez-Bare_2019}, and \citet{Hu_Li_Wager_2021}). Those papers' identification results rely on \emph{design-based} assumptions around the treatment-assignment mechanism, while this paper relies on \emph{model-based} assumptions, including a modified parallel-trends assumption, for identification in non-experimental settings. I contribute to this literature by formalizing identification results of different treatment effects in non-experimental settings. 

The rest of the paper is structured as follows. Section \ref{sec:po_framework} presents the potential outcomes framework, defines the estimand of interest, discusses identification of effects, and shows the resulting bias from estimating a classical difference-in-differences model. Section \ref{sec:estimation} focuses on the estimation of the direct effect, the total effect, and spillover effects. Section \ref{sec:tva} presents an application for evaluating the Tennessee Valley Authority program. Last, Section \ref{sec:event_study} discusses briefly how to incorporate spillovers into event-study estimation following the insights from \citet{Gardner_2021} and \citet{Borusyak_Jaravel_Spiess_2021}. 


% ------------------------------------------------------------------------------
\section{Potential Outcomes Framework}
\label{sec:po_framework}
% ------------------------------------------------------------------------------

This section presents a potential outcome framework that formalizes spatial spillovers. The goal of this exercise is to define possible treatment effects of interest since they are no longer uniquely defined in settings with spillovers. Following the canonical difference-in-differences framework, I observe a panel of units for periods $t \in \{0,1\}$ and treatment turns on between periods for some of the units.\footnote{This can be extended to multiple periods by replacing $Y_{i0}$ and $Y_{i1}$ throughout with pre- and post- sample averages of $Y_{it}$. This framework is extended to staggered treatment adoption in Section \ref{sec:event_study}.} Let $D_{i}$ be an indicator equal to one if unit $i$ is treated and therefore treatment status is defined as $D_{it} = D_{i} * \one_{t = 1}$.

\begin{assumption}[Random Sampling]\label{assumption:random}
    $\{ Y_{i0}, Y_{i1}, D_{i} \}_{i = 1}^{n}$ is an independent and identically distributed sample of panel data.
\end{assumption}

Assumption (\ref{assumption:random}) allows me to consider observations as coming from a larger population (sometimes called a superpopulation). Later, when discussing inference, I will relax this assumption to account for spatial correlation between observations, but identification does not rely on independence. As an alternative, inference could come from a design-based perspective following \citet{Athey_Imbens_2021}.

Potential outcomes, denoted $Y_{it}(D_i, h_i(\vec{D}))$, are a function of unit $i$'s own treatment-status $D_i$ and, departing from the standard potential outcomes framework, of a function of the entire vector of treatment assignments $h_i(\vec{D})$ where $\vec{D} \in \{0,1 \}^n$ denotes the $n$-dimensional vector of all unit treatments. The non-negative scalar- or vector-valued function $h_i(\vec{D})$ is referred to as an `exposure mapping'. This setup follows \citet{Vazquez-Bare_2019} who studies identification of spillover effects under an experimental setting.\footnote{Note that throughout, expectations and inference are conditional on the vector of exposure mappings. In design-based settings, the distribution of exposure mappings is known so expectations can be taken without conditioning on the vector of exposure mappings. See \citet{Savje_Aronow_Hudgens_2021} for discussion estimation and inference when the treatment design is known.}

The exposure mapping formalizes violations to the stable-unit treatment value assumption (SUTVA) by summarizing the intensity at which unit $i$ is affected by spillovers. Without any restrictions on the exposure mapping, nonparametric identification of treatment effects is impossible. The main assumption for identification, as is formalized in section \ref{sec:remove_bias}, is that when unit $i$ is sufficiently `far' away, it has no exposure to spatial spillovers and $h_i(\vec{D}) = \vec{0}$ . In the world of no spillovers, that is $h_i(\vec{D}) = \vec{0}$ for all individuals, potential outcomes would return to only depending on own-treatment status.

The identification results of this paper do not require parameterization of the exposure mapping. However, to help better understand the exposure mapping, I give three examples that are commonly used in the literature. 

\begin{example}
    $h_i(\vec{D})$ can be an indicator variable that equals one only if there is a treated unit within $\bar{d}$ miles of unit $i$.\footnote{Similarly, a dummy for counties that share contiguous borders is commonly used.} Let $d(i,j)$ be a distance measure that is the distance between unit $i$ and $j$.  In this case \begin{equation}\label{eq:h_within}
        h_i(\vec{D}) = \max_{j \neq i} D_j * \one_{ d(i,j) < \bar{d}}
    \end{equation}
    This exposure mapping is a realistic specification when it is assumed that spillover effects do not decay over distance until $\bar{d}$ and the intensity of spillovers does not depend on the number of neighboring units treated. For example, this exposure mapping likely applies in the context of new library creation \citep{Berkes_Nencka_2020}. In this case, the distance $\bar{d}$ would be the maximum distance people would travel to a nearby library. The benefits of access to a neighboring town library do not depend on whether people can access 1 or more nearby libraries, so the binary exposure mapping is a good approximation to spillovers in this context.  
\end{example}
    
\begin{example}
    Second, $h_i(\vec{D})$ can be a function that equals the number of units treated within distance $\bar{d}$, i.e. \begin{equation}\label{eq:h_within_additive}
        h_i(\vec{D}) = \sum_{j \neq i} D_j * \one_{d(i,j) < \bar{d}}.
    \end{equation}
    This exposure mapping is no longer binary, so the intensity of spillovers is additive in the number of nearby units treated. In the context of wholesale store openings, this exposure mapping captures the additive nature of agglomeration economies. As more nearby counties receive new stores, the force of agglomeration and therefore the spillover effect increases (e.g. \citet{Basker_2005}).
\end{example}
    
\begin{example}
    Last, $h_i(\vec{D})$ is a spatial decay function where exposure decreases with distance. In this case, spillover intensity is the sum across all treated observations' decay terms, i.e. \begin{equation}\label{eq:h_decay}
        h_i(\vec{D}) = \sum_{j \neq i} D_j e^{-\alpha d(i,j)}.
    \end{equation} 
    This exposure mapping allows for the intensity of spillovers to depend on the distance to treatment and also is additive in the number of nearby units treated.\footnote{However, this specification assumes that all units are affected by all other units. This creates problems with inference because it implies a potential correlation between all units' error terms. For this reason, this function often is summed over only the $k$-nearest neighbors or units within $\bar{d}$ miles.} The speed that spillover effects decay over distance depends on the parameter $\alpha$ that can be calibrated by the researcher or estimated using a non-linear least-squares routine. In the literature on R\&D investment, for example, \citet{Keller_2002} uses a modified version of this exposure mapping where $D_j$ is country $j$'s R\&D expenditure. This specification features exponential decay over distance which captures the theoretical insight that research spending in closer locations has a larger effect than further away spending.
\end{example}

Often, researchers will try to parameterize potential outcomes by reasoning through the nature of the spillovers in a way similar to the above examples. Estimation in this case will rely on the functional form assumptions made by researchers. This paper will take an alternative approach to identification and estimation which will allow for estimation of treatment effects without requiring direct knowledge of the functional form of the exposure mapping/potential outcomes. 

In particular, I will redefine the standard difference-in-differences identifying assumptions in the context of the new potential outcome framework. First, I assume that units do not adjust their actions in period $0$ from knowledge of future treatment:
\begin{assumption}[No Anticipation]\label{assumption:no-anticipation}
    $Y_{i0}(D, h) = Y_{i0}(0,0)$ for all values of $D$ and $h$.
\end{assumption}
Second, I formalize the parallel counterfactual trends assumption as follows:
\begin{assumption}[Parallel Counterfactual Trends]\label{assumption:parallel}
    Counterfactual trends do not depend on $D_i$:
    \[ 
        \expec{Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0}) \ \vert \ D_i = 1 } = 
        \expec{Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0}) \ \vert \ D_i = 0 }
    \]
\end{assumption}
This assumption states that in the absence of treatment and with zero exposure (not just the absence of individual $i$'s treatment), the change in potential outcomes from period 0 to 1 would not depend on treatment status. This generalizes to the classic parallel counterfactual trends when SUTVA is satisfied because then every unit has zero exposure. 

% ------------------------------------------------------------------------------
\subsection{Treatment and Spillover Effects}
% ------------------------------------------------------------------------------

In setups without spillovers, the treatment effect for an individual unit is well defined as $\tau_i \equiv Y_{i1}(1) - Y_{i1}(0)$, i.e. the effect of turning on treatment for a unit, and the above two assumptions would lead to the identification of the average effect by the traditional difference-in-differences estimator. In the presence of spillovers, multiple treatment effects can be defined in this setting. This subsection will define them and discuss their relative advantages/disadvantages. 

The natural analogue to the above treatment effect which I will label the `switching effect' is:
\[
    \tau_{i, switch}(\vec{h}) \equiv Y_{i1}(1, \vec{h}) - Y_{i1}(0, \vec{h}).
\] 
This is the effect of changing only unit $i$'s treatment status while keeping their exposure to spillovers constant at some value $\vec{h}$. This treatment effect is policy-relevant as it summarizes what would happen if a `local' policymakers decide to enact the policy for unit $i$ (implicity keeping $\vec{h}$ constant).\footnote{This is what \citet{Savje_Aronow_Hudgens_2021} call the `assignment-conditional unit-level treatment effect'.} It is important to note that the switching effect can depend on the level of exposure. For instance, consider the construction of libraries in towns. The effect of library construction in a town that is far away from any other library (exposure of $\vec{0}$) can be different than a town that is very close to a neighboring town's library (large $\vec{h}$), hence the dependence of $\tau_{i, switch}$ on $\vec{h}$. Since the size of the switching effect depends on a unit's exposure level, we will consider an average switching effect at each value of exposure, 
\[
    \tau_{\text{switch}}(\vec{h}) \equiv \condexpec{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(0, h_i(\vec{D}))}{D_i = 1, h_i(\vec{D}) = \vec{h}}.
\]

% Work by \citet{Savje_Aronow_Hudgens_2021} suggests averaging the switching effect over exposure levels,
%\[ 
%    \tau_{\text{avg,switch}} \equiv \expec{\tau_{i, switch}(h_i(\vec{D})) \vert D_i = 1}.
%\] 
%This estimand averages the switching effect over all treated units and hence average over the distribution of exposure. Any given unit $i$ trying to understand the effect of switching on a policy can't use this parameter as it averages over exposures different than theirs. More, this parameter can not be identified without further assumptions as the distribution of exposure mappings is not necessarily the same for control units as treated units.\footnote{\citet{Savje_Aronow_Hudgens_2021} discuss conditions on the distribution of exposure mappings that can lead to asymptotic identification of the average switching effect. However it relies on design-based assumptions that do not apply here.}

There is a particular switching effect at zero exposure that I call the `direct effect' of treatment, 
\[
    \tau_{\text{direct}} \equiv \expec{Y_{i1}(1, \vec{0}) - Y_{i1}(0, \vec{0}) \ \vert \ D_i = 1, h_i(\vec{D}) = \vec{0}} = \tau_{\text{switch}}(\vec{0}),
\] 
which measures the average effect of being treated \emph{among unexposed treated units}. Specifying this particular switching effect will prove useful when discussing identification as it requires fewer assumptions than switching effects at other exposure levels. As discussed above, this is not necessarily a policy-relevant parameter for every unit if the switching effect has different magnitudes at different levels of exposure. 

The second policy-relevant parameter is the `total effect of treatment': 
\[
    \tau_{\text{total}} \equiv \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(0, \vec{0}) \ \vert \ D_i = 1}.
\] 
As opposed to the switching effect, which keeps exposure constant, the total effect looks at turning on treatment \emph{and} going from zero exposure to $h_i(\vec{D})$ simultaneously. This can be thought of as going from the world with a \emph{complete} absence of treatment, $\vec{0}$ to the current treatment vector $\vec{D}$. This treatment effect is helpful for `national' policymakers to evaluate what \emph{were} the effects of the entire vector of \emph{enacted policies}. 

To better understand how the above treatment effects are connected, it will be useful to formalize a unit's `spillover effect' as:
\[
    \tau_{i, \text{spill}}(D_i, h_i(\vec{D})) \equiv Y_{i1}(D_i, h_i(\vec{D})) - Y_{i1}(D_i, \vec{0}).
\] 
The spillover effect measures the difference in potential outcomes between being exposed at intensity $h_i(\vec{D})$ and not being exposed. This effect can differ for either treated or control units as the magnitude or even the nature of spillovers might differ between treated and untreated units. That is $\tau_{i, \text{spill}}(1, h_i(\vec{D}))$ does not necessarily equal $\tau_{i, \text{spill}}(0, h_i(\vec{D}))$. We can then average over treated/control units to form average spillover effects: 
\[
    \tau_{\text{spill}}(D) \equiv \expec{Y_{i1}(D, h_i(\vec{D})) - Y_{i1}(D, \vec{0}) \ \vert \ D_i = D},
\]
where the expectation is over individuals and hence over different exposures. This will give us the average spillover effect among \emph{all} treated/control units regardless if they experience any spillover effects. It is often also of interest to estimate the average spillover effects on subsets of units (e.g. all units experiencing non-zero exposure). Estimation of spillover effects will be discussed in Section \ref{sec:spill}.

With spillover effects formally defined, the difference between the proposed estimands become more clear by the following algebraic identity:
\begin{align*}
    &\overbrace{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(0, h_i(\vec{D}))}^{\text{Switching Effect}} = \\
    &\quad\quad \underbrace{\underbrace{Y_{i1}(1, 0) - Y_{i1}(0,0)}_{\text{Direct Effect}} \ + \ \underbrace{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(1, 0)}_{\text{Spillover on Treated}}}_{\text{Total Effect}} \ - \ \underbrace{(Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0,0))}_{\text{Spillover on Control}} 
\end{align*}

From this identity, we see that whenever $\tau_{i,spill}(D_i, h(\vec{D}_i))$ does not depend on treatment status $D_i$, then we have that the switching effect is constant and equal to the direct effect. In this situation, the simpler identification assumptions behind the direct effect will identify the switching effect at all exposure levels. For example, if treatment is a factory opening and the spillover effect on employment is due to increased spending on services, then it could be reasonable to assume the effect does not depend on treatment status and hence the switching effect is constant and equal to the direct effect. 

However, the spillover effects can sometimes differ depending on treatment status. Continuing the above example, perhaps control units could experience negative employment shocks from a nearby country opening a factory if workers relocate/commute to the treated areas resulting in a negative spillover effect on control units. Other treated units could, for instance, experience positive spillover effects due to agglomeration economies. When it is the case that spillover effects depend on treatment status, the switching effect can be thought of as two separate effects. First, the unit is affected by changing its treatment status as summarized by the direct effect. Second, the unit changes from experiencing spillover effects as a control unit to experiencing spillover effects as a treated unit.

% ------------------------------------------------------------------------------
\subsection{What Does Difference-in-Differences Estimate?}
% ------------------------------------------------------------------------------

With treatment effects properly defined, I will first derive what the standard difference-in-differences estimand identifies under parallel trends assumption. 

\begin{proposition}[Decomposition of Difference-in-Differences Estimand]\label{thm:bias}\ \\    
    If assumptions (\ref{assumption:random}), (\ref{assumption:no-anticipation}) and \nameref{assumption:parallel} hold, the population difference-in-differences estimand can be decomposed as follows:
    \begin{align}
        &\underbrace{\expec{Y_{i1} - Y_{i0} \ \vert \ D_i = 1 } - \expec{Y_{i1} - Y_{i0} \ \vert \ D_i = 0 }}_{\text{Difference-in-Differences}} \label{eq:did}\\ 
        &\quad\quad= \tau_{\text{direct}} + \tau_{\text{spill}}(1) - \tau_{\text{spill}}(0) \\ 
        &\quad\quad= \tau_{\text{total}} - \tau_{\text{spill}}(0)
    \end{align}
\end{proposition}

The proof is given in Appendix \ref{sec:proofs}, but the intuition behind the additional terms is as follows. First, the change in outcomes among treated units combines the direct effect of treatment with the spillover effects caused by nearby treated units. Therefore the first difference adds the average spillover effect onto the treated units, $\tau_{\text{spill}}(1)$. Second, the change in outcomes among control units combines the parallel counterfactual trend with the average spillover effect onto control units. Since $\hat{\tau}$ is found by subtracting the change in outcomes among the control units, we subtract the average spillover effect onto the control, $\tau_{\text{spill}}(0)$. 

Researchers typically estimate the canonical two-way fixed-effects model, 
\begin{equation}\label{eq:twfe}    
    y_{it} = \tau D_{it} + \mu_i + \lambda_t + \epsilon_{it}.
\end{equation}
The estimator $\hat{\tau}$, which is well understood to be the sample analog of (\ref{eq:did}), is, therefore, a biased estimate for $\tau_{\text{direct}}$ and $\tau_{\text{total}}$ in the presence of spillovers. In particular, if a researcher estimates a difference-in-differences model and reports $\hat{\tau}$ as an estimate of the total effect, their estimate would be biased in the presence of spillover effects on control units. If spillover effects are of the same sign as the total effect, then estimates would be attenuated towards zero. On the other hand, if spillovers are the opposite sign, then results would increase in magnitude. 

% ------------------------------------------------------------------------------
\subsection{Identification of Treatment Effects}\label{sec:remove_bias}
% ------------------------------------------------------------------------------

The following subsection will talk about the identification of treatment effects and present corresponding estimators for each effect. 

% ------------------------------------------------------------------------------
\subsubsection{Switching Effect}
% ------------------------------------------------------------------------------

It is difficult to identify the switching effect in general as identifying the unobserved counterfactual outcome $Y_{i1}(0, h_i(\vec{D}))$ requires knowledge of which control units have the same level of exposure. The reason for this can be seen by rewriting this in terms of a difference-in-differences style estimand:
\begin{align*}
    \tau_{\text{switch}}(\vec{h}) &= \mathbb{E} \left[ Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0,\vec{0}) \mid D_i = 1, h_i(\vec{D}) = \vec{h} \right] \\ 
    &\quad\quad - \mathbb{E} \left[ Y_{i1}(0, h_i(\vec{D})) - Y_{i0}(0,\vec{0}) \mid D_i = 1, h_i(\vec{D}) = \vec{h} \right].
\end{align*}
Writing it in this way highlights the two problems in estimating the second term. First, this requires knowledge of the unobserved exposure mapping to be correctly specified to identify control units with $h_i(\vec{D}) = h$. More, this estimand requires a more demanding parallel trends assumption.\footnote{This problem is similar to those highlighted by \citet{Callaway_Goodman-Bacon_SantAnna_2021} for difference-in-differences with continuous treatment.}  

\begin{assumption}[Switching Effect Parallel Trends]\label{assumption:parallel-switching}
    For a given exposure, $\vec{h}$, counterfactual trends do not depend on $D_i$:
    \[ 
        \expec{Y_{i1}(0, \vec{h}) - Y_{i0}(0, \vec{0}) \ \vert \ D_i = 1, h_i(\vec{D}) = \vec{h} } = 
        \expec{Y_{i1}(0, \vec{h}) - Y_{i0}(0, \vec{0}) \ \vert \ D_i = 0, h_i(\vec{D}) = \vec{h} }
    \]
\end{assumption}

This assumption requires parallel trends among treated and control units at exposure $\vec{h}$. This assumption is implied by \nameref{assumption:parallel} and an additional assumption that spillover effects are equal between control and treated units that experience exposure $\vec{h}$. Under this assumption, the switching effect can be identified.

\begin{proposition}[Identification of the Switching Effect]
    For a given exposure, $\vec{h}$, if assumption (\ref{assumption:random}), (\ref{assumption:no-anticipation}), and \nameref{assumption:parallel-switching} holds, then 

    \begin{align*}
        \tau_{\text{switch}}(\vec{h}) &= \mathbb{E} \left[ Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0,\vec{0}) \mid D_i = 1, h_i(\vec{D}) = \vec{h} \right] \\ 
        &\quad\quad - \mathbb{E} \left[ Y_{i1}(0, h_i(\vec{D})) - Y_{i0}(0,\vec{0}) \mid D_i = 0, h_i(\vec{D}) = \vec{h} \right].
    \end{align*}
\end{proposition}

The switching effect can be estimated by a difference-in-differences estimator on the subsample of units with exposure $\vec{h}$. However, this approach relies on correct specification of the exposure mapping which is a difficult assumption to maintain in practice. Researchers may be tempted to introduce the parameterized exposure mapping linearly to ``compare individuals at the same level $\vec{h}$''. However, this assumes additive separability between the treatment dummy and the exposure mapping. Additive separability would imply the switching effect does not depend on exposure level, i.e. the switching effect is constant across $\vec{h}$.

\subsubsection{Direct and Total Effects}

To identify the direct and total effects, additional assumptions on the nature of spillover effects are needed. In particular, I will formalize the idea that spillovers are `local' in that units are only affected by treatment if they are near treatment. For example, if treatment has to be accessed in person, then it is natural that further away places are not affected by treatment. However, this assumption may fail under general equilibrium shocks that do not necessarily decay over distance.

\begin{assumption}[Spillovers Are Local]\label{assumption:local}
    There exists a distance $\bar{d}$ such that 
    
    (i) For all units $i$,
    \[ 
        \min_{j: \ D_j = 1} d(i,j) > \bar{d} \implies h_i(\vec{D}) = \vec{0}. 
    \]

    (ii) There are treated and control units, $i$, such that $\min_{j: \ D_j = 1} d(i,j) > \bar{d}$.
\end{assumption}

Part (i) of assumption (\ref{assumption:local}) requires that spillovers are `local' in that units are no longer exposed to spillovers after some maximum distance $\bar{d}$. Part (ii) of Assumption (\ref{assumption:local}) requires that there exists control and treated units with no exposure. This assumption is far less strict than the identifying assumption for the switching effect in that we only need to identify units with non-zero exposure and don't need to parameterize the exposure mapping any further. For a given $\bar{d}$ that satisfies Assumption (\ref{assumption:local}), let $S_{i}$ be an indicator equal to one if $\min_{j: \ D_j = 1} d(i,j) \leq \bar{d}$, i.e. unit $i$ is within $\bar{d}$ miles of the closest treated unit.

The intuition behind identifying the direct effect separately from the spillover effects requires that we use control units experiencing no spillover effects to identify the counterfactual trend and use treated units experiencing no spillover effects to identify the direct effect. Since we are leveraging subgroups of treated and control units, we need a parallel trends assumption for each subgroup:

\begin{assumption}[Direct/Total Effect Parallel Trends]\label{assumption:parallel-mod}
    Counterfactual trends do not depend on $D_i$ and $S_i$:
    \[
        \expec{Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0}) \ \vert \ D_i, S_i} = 
        \expec{Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0})}
    \]
\end{assumption}

It is worth remarking on \nameref{assumption:parallel-mod} in terms of applied work. Often, individuals use only a subsample of observations that are close to treated observations in estimating their difference-in-differences model. The idea is that close units are more likely to be on similar counterfactual trends than units that are further away. The identification result and its corresponding estimator are formed by using further away units (i.e. units with $S_i = 0$). In this case, if parallel trends only hold locally, then focusing on further away units can fix the spillover bias but increase bias from non-parallel trends.

Note that for identification of the total effect, you only need that the counterfactual trend among \emph{all} treated units is the same as the counterfactual trend among control units with $S_i = 0$ which is implied by \nameref{assumption:parallel-mod}. Identification of the direct effect will be average the individual treatment effects \emph{only} for treated units with $S_i = 0$. So identification of the average treatment effect among \emph{all} treated units requires a subtle assumption to ensure treatment effect homogeneity.

\begin{assumption}[Direct Effect Does Not Depend on $S_i$]\label{assumption:homogenous-direct}
    For $s \in \{0, 1\}$,
    \[
        \expec{Y_{i1}(1, \vec{0}) - Y_{i1}(0, \vec{0}) \ \vert \ D_i = 1, S_i = s} = 
        \expec{Y_{i1}(1, \vec{0}) - Y_{i1}(0, \vec{0}) \ \vert \ D_i = 1}
    \]d
\end{assumption}

With these assumptions, we have the following identification result for the direct and total effects:

\begin{proposition}[Identification of Direct and Total Effects]\label{thm:remove_bias}
    If assumption (\ref{assumption:random}), (\ref{assumption:no-anticipation}), 
    
    \noindent\nameref{assumption:local}, and \nameref{assumption:parallel-mod} hold, then (i) 
    \begin{equation}\label{eq:id_total}
        \expec{Y_{i1} - Y_{i0} \ \vert \ D_i = 1} - \expec{Y_{i1} - Y_{i0} \ \vert \ D_i = 0, S_{i} = 0} = \tau_{\text{total}}
    \end{equation}
    and (ii) 
    \begin{align}\begin{split}\label{eq:id_direct}
        &\expec{Y_{i1} - Y_{i0} \ \vert \ D_i = 1, S_{i} = 0 } - \expec{Y_{i1} - Y_{i0} \ \vert \ D_i = 0, S_{i} = 0 } \\
        &\quad\quad= \expec{Y_{i1}(1, \vec{0}) - Y_{i1}(0, \vec{0}) \ \vert \ D_i = 1, S_i = 0}\\
        &\quad\quad= \tau_{\text{direct}},
    \end{split}\end{align}
    where the last equality holds only under assumption \nameref{assumption:homogenous-direct}.
\end{proposition}

The proof is given in Appendix \ref{sec:proofs}, but the intuition is simple. Conditioning on $S_i = 0$ will use only observations with $h_i(\vec{D}) = 0$ which gives rise to the identification of the direct and total effect. 
This proposition shows that a researcher does not need to know how the spillovers occur over space to have an unbiased estimate for treatment effects. All that is required to identify the direct or total effects is being able to classify which units are considered `close' to treatment.\footnote{In contexts with different measures of `distance', note that this result only requires an indicator that captures all affected units. For example, thinking about spillovers between industries, this requires the researcher to correctly identify which industries are affected by spillovers and which are not.} 

% ------------------------------------------------------------------------------
\section{Estimation of Effects}\label{sec:estimation}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\subsection{Estimation of Direct and Total Effects}
% ------------------------------------------------------------------------------

To estimate the direct effect and the total effect, we could replace the terms in proposition \ref{thm:remove_bias} with their sample analogs. However, it will prove advantageous to modify the two-way fixed-effects model to estimate the direct or the total effect because it will allow the estimation of spillover effects as well. To estimate the total effect, the modified model is given by: 
\begin{equation}\label{eq:twfe_total}    
    y_{it} = \tau D_{it} + \gamma_{0} (1-D_{it}) S_{i} + \mu_i + \lambda_t + \epsilon_{it}.
\end{equation}

To estimate the direct effect, the modified model is given by:
\begin{equation}\label{eq:twfe_direct}    
    y_{it} = \tau D_{it} + \gamma_0 (1-D_{it}) S_{i} + \gamma_1 D_{it} S_{i} +  \mu_i + \lambda_t + \epsilon_{it}.
\end{equation}
From standard regression analysis the estimates of $\hat{\tau}$ from equations (\ref{eq:twfe_direct}) and (\ref{eq:twfe_total}) are sample analogues of (\ref{eq:id_direct}) and (\ref{eq:id_total}).

Since $\hat{\tau}$ is a linear combination of sample averages, inference can be done using large-n asymptotics. However, it is important to account for two sources of correlation in the error structure. First, errors should be clustered by unit $i$ to allow for correlation across periods. Second, since our model is predicated on the fact that nearby places affect one another, we should account for such spatial correlation by allowing for spatial correlations following \citet{Conley_1999}. More recent work by \citet{Ferman_2020} show that for large-n asymptotics to be used, the structure of spatial correlation must be limited in that errors are assumed to be uncorrelated after a certain cutoff distance. A natural candidate for this cutoff would be $\bar{d}$ used for the creation of $S_i$. 

A natural question is why wouldn't researchers make the distance large to guarantee they have an unbiased estimate of $\tau_{\text{direct}}$ or $\tau_{\text{total}}$? Equation (\ref{eq:id_total}) and (\ref{eq:id_direct}) should make this problem clear. Since these estimates rely on averages among units with $S_i = 0$, as $\bar{d}$ increases, the number of units with $S_i = 0$ decreases which yields more variable estimates. On the other hand, having units that experience spillovers not included in the $S_i$ indicator will leave some bias in the estimate.\footnote{Although, spillover effects typically will grow weaker over distance and if distant units are mistakenly treated as if they have zero exposure, bias should be small.} Therefore there is a bias-variance trade-off in extending the extent of $S_i$ that should be balanced by researchers guided by their particular economic context. In separate work, \citet{Butts_2021} discusses data-driven methods to determine how far $S_i$ should be under a more strict parallel trends assumption.

% ------------------------------------------------------------------------------
\subsection{Estimation of Spillover Effects}\label{sec:spill}
% ------------------------------------------------------------------------------

The estimates of $\gamma_D$ in the modified TWFE models (\ref{eq:twfe_total}) and (\ref{eq:twfe_direct}) do not estimate the corresponding average spillover effects $\tau_{\text{spill}}(D)$ for $D = 0,1$. This is because $\hat{\gamma}_D$ average spillover effects across only units with $S_i = 1$:
\[ 
    \expec{\hat{\gamma}_0} = \condexpec{\tau_{i, spill}(0)}{ S_i = 1, D_i = 0}, \text{ and}
\]
\[ 
    \expec{\hat{\gamma}_1} = \condexpec{\tau_{i, spill}(1)}{ S_i = 1, D_i = 1}.
\]
These estimates average spillover effects for all units with $S_i = 1$. Since some units with $S_i = 1$ do not have positive exposure, this is not the average spillover effect for units with non-zero exposure either. For example, if only units really close to treatment receive spillover effects and $S_i$ contains a lot of units that experience no spillover effects, then $\hat{\tau}_{\text{spill, control}}$ could be estimated near zero even though some units experience substantial spillover effects.

It is possible to more accurately estimate spillover effects by using a set of concentric ring indicators (e.g 0-20 miles, 20-40 miles, and 40-60 miles from the nearest treated unit) instead of a single large ring indicator to more flexibly estimate the spillover effects. For example, for the total effect, equation (\ref{eq:twfe_total}) can be modified as 
\begin{equation}\label{eq:twfe_total_rings}    
    y_{it} = \tau D_{it} + \sum_{i=1}^n (1-D_{it}) \text{Ring}_{i} + \mu_i + \lambda_t + \epsilon_{it},
\end{equation}
where $\text{Ring}_i$ is a given ring. Similarly, equation (\ref{eq:twfe_direct}) can be modified to include multiple rings. Since the set of rings is collinear with a single large ring, the direct and total effects estimate will continue to be identified. The estimates for each ring will represent the average of $\tau_{i,spill}$ for all observations within a given distance ring. Having estimates of average spillover effects at different distances allows a researcher to better understand the nature of the spillovers.

A simple example of how rings improve the estimation of spillover effects can be seen in Figure \ref{fig:example_rings}. The figure displays observations of $Y_{i,1} - Y_{i,0}$ on the y-axis and the distance to the nearest treated unit on the $x$-axis. Treated units are placed at a zero distance for visualization purposes. The example has a counterfactual trend of 2 so any difference from 2 is due to either treatment/spillover effects and the error term. 

% Figure: Example Rings --------------------------------------------------------
\begin{figure}[tb!]
    \caption{Comparison of Single vs. Multiple Rings Estimation of Spillover Effects}
    \label{fig:example_rings}

    \includegraphics[width = \textwidth]{../../figures/figure-rings_v_within.pdf}

    {\footnotesize \textit{Notes:} The figure compares estimates of equation (\ref{eq:twfe_total}) with $S_i$ a ring of $(0, 60]$ miles from the nearest treated unit and of equation (\ref{eq:twfe_total_rings}) with rings for $(0,15], (15,30], (30,45], (45, 60]$ miles for a simulated set of data.}
\end{figure}

Panel (a) uses a single indicator for being between 0 and 60 miles from treatment and the difference between the bar and the estimated counterfactual trend is the estimated spillover effect which in this case is about 0.6. This number masks that units within the first 15 miles have a treatment effect of 1 or larger and units between 40 and 60 miles have 0 spillover effects. Figure (b) on the other hand uses 4 indicators for every 15-mile interval (0-15, 15-30, 30-45, and 45-60 miles). This improves the estimate of a single ring in two ways. Multiple rings are better able to capture the decaying nature of spillover effects over distance. Furthermore, the ring that is included past the true maximum distance where spillover effects occur (45-60 miles) has a point estimate near zero. The rings method is a semi-parametric estimator in the sense that as the number of rings increase and their width shrinks, the estimates would trace out the spillover effect function (subject to $\bar{d}$ satisfying assumption (\ref{assumption:local})). However, the precision of estimates would decrease as the number of rings increases and therefore there is a bias-variance trade-off in the number and width of rings.\footnote{\citet{Clarke_2017} proposes a cross-validation technique for optimally choosing the number of rings and their techniques that uses the out-of-sample mean square prediction error as a way to estimate the bias-variance tradeoff. \citet{Butts_2021} provides a data-driven method to selecting rings under a more strict version of the parallel trends assumption.} 

One disadvantage of using a set of indicators for \textit{the nearest} treated unit is that some spillover effects are additive in the number of nearby treated units. In this case, summarizing exposure by the distance to the closest treated unit fails to capture important information on the location of other treated units and the coefficients on the ring indicators might be interpreted incorrectly. One potential solution is to count the number of treated units within each ring instead of creating indicators for the nearest treated unit. This additive version of rings however no longer removes all bias from the direct effect of treatment unless the exposure mapping is correctly specified. Therefore, if spillover effects are expected to be additive in nature, separate estimation of the direct effect and spillover effects would be the preferred method. 

% ------------------------------------------------------------------------------
\section{Application in Place-Based Policy Analysis}
\label{sec:tva}
% ------------------------------------------------------------------------------

To illustrate the importance of accounting for spatial spillovers in the estimation of treatment effects, I revisit the analysis of the Tennessee Valley Authority (TVA) in \citet{Kline_Moretti_2014}. The TVA program was a large-scale federal investment started in 1934 that focused on the construction of dams and transportation canals in an attempt to modernize the Tennessee Valley's economy. By the end of WWII, the TVA became the largest single power supplier in the country and significantly lowered the cost of wholesale energy for factories.\footnote{More details on the program are found in \citet{Kline_Moretti_2014}. The effects on wholeseale electricity are discussed in \citet{Kitchens_2014}.} With over \$20 Billion (in 2000 dollars) spent which is hundreds of dollars transferred per person in the Authority, the impacts are very likely to extend past the authority's borders. \citet{Kline_Moretti_2014} analyze a range of outcome variables, but for succinctness, I use only (the log of) agricultural and manufacturing employment. Since the TVA primarily improved manufacturing industries through large-scale electrification, the authors predict that employment will grow in manufacturing and shrink in agricultural as workers switch to higher-paying manufacturing jobs. 

The analysis in \citet{Kline_Moretti_2014} begins by comparing changes in county-level outcomes from 1940 to either 1960 (short run effects) or 2000 (long run effects) between treated counties in the Authority and control counties outside. The primary specification is
\begin{equation}\label{eq:tva}
    y_{c, t} - y_{c, 1940} = \alpha + \text{TVA}_c \tau + X_{c, 1940} \gamma + (\varepsilon_{c, t} - \varepsilon_{c, 1940}),
\end{equation}
where $c$ denotes county, $\text{TVA}_c$ is an indicator variable for being in the Authority, and $y$ is a set of outcome variables (in logs).\footnote{The two-period difference-in-differences regression is equivalent to a first-difference regression. The authors use an Oaxaca-Blinder estimator on the first differences and the results of \citet{Kline_2011} show that this estimator is equivalent to a weighted difference-in-differences estimate. Their estimator does not differ much from the standard difference-in-differences results since the weights are not that different from uniform weights.} Pre-treatment control variables, $X_{c,1940}$, are interacted with $\text{Post}_t$ to allow for places to be on different long-term trends.\footnote{See footnote 8 in \citet{Kline_Moretti_2014} for a full listing of control variables.} To improve the likelihood of the parallel trends assumption, they run a logistic regression to predict being in the TVA based on their set of control variables $X_{c,1940}$ and keep only observations in the top 75\% of predicted probability. The counties used in the sample are presented in Figure \ref{fig:tva_sample}. \citet{Kline_Moretti_2014} estimate (\ref{eq:tva}) to identify the `local effect' of the TVA -- what I am calling the `direct effect'. However, their point estimates compare, in part, changes in outcomes in TVA counties with changes in outcomes for neighboring counties that likely were impacted by the large-scale program. 

In the paper, the authors discuss the nature of spillovers that can occur. For agriculture employment, the authors claim that improved wages in the Authority will draw agriculture workers out of nearby counties. Hence they predict a negative spillover. For manufacturing, the sign is ambiguous. There could be positive spillovers if electrification brought cheap power and agglomeration economies to the neighboring areas. However, manufacturing could decline if firms chose to locate in the Authority that would have, in the absence of the program, decided to locate in nearby counties. My methodology will allow me to empirically test these predictions in the data and remove their bias from the treatment effect estimates. 

By comparing counties inside the Authority to counties on the other side of the border, the authors likely underestimate the negative effect on agricultural employment while the bias in the manufacturing effect is theoretically ambiguous. The authors do recognize the problem of these comparisons and remove counties that share borders with the authority, but due to the scale of the program, the spillovers are likely to extend further than this. Therefore, bias in their estimate will likely remain even after dropping contiguous counties. The estimation strategy I present keeps the observations near the TVA while controlling for spillover effects in a more rigorous manner.  

% Figure: TVA Effective Sample and Spillover Variables
\begin{figure}[tb!]
    \caption{TVA Effective Sample and Spillover Variables}
    \label{fig:tva_sample}

    {\centering
        \resizebox{\textwidth}{!}{
            \includegraphics{../../figures/figure-tva-sample.pdf}
        } 
    }
    {\footnotesize \textit{Notes:} The above figure plots all the counties used in the estimation. Counties that fall within the distance intervals $\{ (0, 50], (50, 100], (100, 150], (150, 200] \}$ measured in miles are colored by their respective bin.} 
\end{figure}

I extend their analysis to control for spatial spillovers in the difference-in-differences specification. To parametrize the exposure mapping, I use a set of rings as described in Section \ref{sec:spill}. Specifically, 
the specification with spillovers is given as follows:  
\begin{equation}\label{eq:tva_spillover}
    y_{i, t} - y_{i, 1940} = \alpha + \text{TVA}_i \tau + \sum_{d \in \text{Dist}} \text{Between}(d)\delta_d + X_{i, 1940} \beta + (\varepsilon_{i, t} - \varepsilon_{i, 1940}),
\end{equation} 
where $\text{Dist} = \{(0, 50], (50, 100], (100, 150], (150, 200]\}$ measured in miles and define $\text{Between}(d)$ as an indicator for being within the interval $d \in \text{Dist}$ away from the Authority and $t \in \{1960, 2000\}$. Figure \ref{fig:tva_sample} displays the four spillover variables by filling in each distance bin in a different color. The coefficients $\delta_d$ estimate the average spillover effect onto control units for each of these distance bins. From proposition \ref{thm:remove_bias}, $\hat{\tau}$ will be an unbiased estimate for the `total' effect so long as spillovers do not occur past 200 miles from the TVA.

The results of the long run analysis from 1940 to 2000 are presented in Panel A of Table \ref{tab:tva}. Each row contains the results for a different outcome variable (measured in logs). Columns (1)-(5) contain point estimates for $\tau$ and $\delta_d$'s in different specifications. The point estimates can be interpreted as decadal growth rates in outcomes. The column labeled difference-in-differences uses an ordinary least squares estimator for the specification without spillovers, equation (\ref{eq:tva}). This estimate finds a decline in agricultural employment of about $5.1\%$ per decade and an increase in manufacturing employment of about $5.6\%$ per decade. 

% Table: Effects of Tennessee Valley Authority on Decadal Growth
\begin{table}[!tb]
    \caption{Effects of Tennessee Valley Authority on Decadal Growth}
    \label{tab:tva}
    \renewcommand{\arraystretch}{1.1}

    \begin{adjustbox}{width = \textwidth, center}
        \begin{threeparttable}
            \begin{tabular}{@{} l c@{\extracolsep{20pt}}c@{\extracolsep{4pt}}cccc @{}}
                % Head
                \toprule

                & \multicolumn{1}{c}{\textbf{Diff-in-Diff}} & \multicolumn{5}{c}{\textbf{Diff-in-Diff with Spillovers}} \\ 
                \cmidrule{2-2} \cmidrule{3-7}
                & & & TVA between & TVA between & TVA between & TVA between \\ 
                & TVA & TVA & 0-50 mi. & 50-100 mi. & 100-150 mi. & 150-200 mi. \\ 
                \textit{Dependent Var.} & (1) & (2) & (3) & (4) & (5) & (6) \\
                
 
                % Body
                \toprule
                \multicolumn{7}{l}{\textbf{Panel A:} 1940-2000} \\
                \midrule
                
                \input{../../tables/tva_replication.tex}

                \\ \toprule
                \multicolumn{7}{l}{\textbf{Panel B:} 1940-1960} \\
                \midrule 

                \input{../../tables/tva_replication_short.tex}

                \\ \bottomrule
            \end{tabular}
            
            % Notes 
            \begin{tablenotes}\footnotesize
                \item \textit{Notes.} Each row corresponds to an outcome variable. Each cell is the point estimate and the standard error for the variable described in the column title. All standard errors are Conley standard errors with a correlation cutoff of 200 miles following \citet{Conley_1999}. The column labeled `Diff-in-Diff' estimates (\ref{eq:tva}) by OLS and is similar to the estimate reported in \citet{Kline_Moretti_2014}. The final four columns labeled `Diff-in-Diff with Spillovers' are estimates from (\ref{eq:tva_spillover}).
                
                \item $^{*} p< 0.1$; $^{**} p < 0.05$; $^{***} p < 0.01$.
            \end{tablenotes}
        \end{threeparttable}
    \end{adjustbox}
\end{table}


Turning to the specification that includes spillovers, equation (\ref{eq:tva_spillover}), column (2) contains a point estimate for $\tau$ and columns (3)-(6) contain point estimates of the spillover effects $\delta_d$. For agricultural employment, the point estimates show there was a decline in agriculture employment in control units near the Authority. For control units between 0 and 50 miles, column (4) indicates a decline in agricultural employment of $3.7\%$ per decade. Between 50 and 100 miles the point estimate is $-1.6\%$ per decade, between 100 and 150 miles the point estimate is $-3\%$ per decade, and between 150 and 2000 miles the point estimate is $-1.6\%$ per decade. This is likely because higher-paying manufacturing jobs within the Authority drew farm-worker migrants from nearby counties. Because the spillovers onto the control counties are negative, the original difference-in-differences estimator was positively biased. The new point estimate indicates a decline of agricultural employment of about $7.4\%$ per decade compared to $5.1\%$ in the standard difference-in-difference specification. 

For manufacturing, our point estimates for spillovers are consistently negative, though imprecisely estimated in some columns. The spillover estimates suggest that neighboring counties experienced potentially negative spillover effects in the long run. Since there are negative spillover effects present, the new point estimate in column (2) of $3.5\%$ is significantly smaller than the original estimate of $5.6\%$. The spillover estimates are evidence that in the long run, urban shadow forces dominate the benefits of urban access. As you move away from the Tennessee Valley, the point estimates become more negative which suggests that the benefits of urban access vanish over distance faster than the costs of urban shadow.

To see how spillover effects from a large-scale place-based policy develop over time, Panel B in Table \ref{tab:tva} presents results for the effects of the Tennessee Valley in the short run using outcome data in 1960. Unlike in the long run, areas near the Tennessee Valley did not experience significant declines in agricultural employment in the short run. Since our long run analysis finds significant increases in high-paying manufacturing employment in the Tennessee Valley, this result is consistent with long run migration costs being lower than short run costs.

For manufacturing, there are potentially positive increases in manufacturing employment within 100 miles of the Tennessee Valley Authority and near-zero effects between 100 and 200 miles. In the short run, it appears that the effects of urban access and the cheap wholesale electricity dominated the effects of urban shadow. The effect of urban shadows can potentially be smaller in the short run if operating firms are unlikely to relocate. long run effects can be larger as entrant firms change their location decision and operating firms are slowly replaced which is what the long run spillover effect estimates suggest.

These results show that including spillovers in the estimation of direct treatment effects is potentially important and can lead to \emph{significant} differences in treatment effect estimates. Analysis of place-based policies that do not account for the fact that treatment effects can spill beyond the borders of treated areas can potentially be biased. More, the spillover effects caused by place-based policies change over time as frictions can create delays in reoptimizing behavior. 

% ------------------------------------------------------------------------------
\subsection{Identification Strategies in Place-Based Policy Analysis}\label{sec:pbp}
% ------------------------------------------------------------------------------

More generally, my framework provides important insights into identification strategies when analyzing the effects of place-based policies. There are two ways I contribute. First, \citet{Baum-Snow_Ferreira_2015} recognize the problem of spatial spillovers causing problems in identification and point to aggregation of units as a way to alleviate the problem (e.g. aggregating census tracts to metropolitan areas). However, this approach combines the treatment and spillover effects, which might each be of interest, into a singular aggregate effect. I have shown that all three effects of place-based policies can be estimated under very general assumptions about the spillovers. Therefore, the methods propose simple ways to estimate treatment effects with non-aggregated data.

Second, my framework provides insight into different identification strategies often used in the literature. Since place-based policies are targeted to specific distressed areas, comparison units are often hard to find. Researchers have developed many identification strategies to find comparison units that are similar in terms of unobservables. First, researchers use border discontinuities to compare treated units to units just on the other side of the border. Other times, researchers compare approved applicants to narrowly rejected applicants. Both strategies aim to balance unobservables between treated and control units. A key difference in these identification strategies is the distance comparison units are from the treated area and therefore the former is more prone to bias due to spillovers than the latter.

For example, consider the analysis of the effects of federal Empowerment Zones. The federal Empowerment Zones are specially designated areas in high-unemployment areas. The program gives businesses located in the zone tax incentives and the goal of the program is to reduce unemployment and poverty. In the literature, there are a set of conflicting results with some papers suggesting that the Empowerment Zones do indeed reduce poverty rates and others finding near-zero effects.\footnote{See Table 1 of \citet{Neumark_Young_2019} for a summary of the various treatment effect estimates in the literature.} 

\citet{Busso_Gregory_Kline_2013} compare census tracts in Empowerment Zones to census tracts that qualified and were rejected from the program. The rejected tracts are not typically geographically near accepted Empowerment Zones and they find large significant reductions in poverty rates. Meanwhile, \citet{Neumark_Kolko_2010} compare census tracts in Empowerment Zones to census tracts within 1,000 feet of the Zone. These control counties are likely the ones that experience the largest spillover effects and they find near-zero effects on poverty. 

My framework can reconcile both of these results. If census tracts just outside the Empowerment Zones also benefit from the policy, then the estimates of \citet{Neumark_Kolko_2010} are attenuated towards zero. These two identification strategies of using rejected applicants or using bordering units as the control group are very common in the urban literature more generally \citep{Baum-Snow_Ferreira_2015}. My paper suggests that the former is the preferred strategy if spillovers occur onto nearby control units. Identification strategies that rely on geographically close control units as having similar unobservables should be used cautiously. If treatment affects units on the other side of a border, then estimated treatment effects can be biased. In Appendix \ref{sec:oz}, I revisit analysis by \citet{Chen_Glaeser_Wessel_2021} on the 2017 Opportunity Zone program who find differing results between the `nearby' and `eligibe, but not selected' methodologies and show that my framework is able to reconcile their differences in estimates.


% ------------------------------------------------------------------------------
\section{Estimating Event Study with Spillovers}
\label{sec:event_study}
% ------------------------------------------------------------------------------

Now, I turn to the common setting where treatment turns on at different times for different units, often called staggered adoption. The intuition from how spillovers cause biases in estimates of the total/direct effect of treatment extends into the staggered adoption setting. In this setting, the literature has shown that two-way fixed-effect estimates can be viewed as a weighted sum of $2 \times 2$ difference-in-differences estimates.\footnote{Various forms for these weights are described in \citet{Goodman-Bacon_2018}, \citet{Sun_Abraham_2020}, and \citet{deChaisemartin_DHaultfoeuille_2019}. I do not recharacterize the weights in this article and guide interested readers to the source articles themselves.} Therefore the bias terms will be an identically weighted sum of the bias term(s) from the $2 \times 2$ estimates, assuming that the parallel counterfactual trends assumption (\ref{assumption:parallel}) holds. However, since weights on some of the $2 \times 2$ estimates can be negative, the sign of the spillover effects does not determine the sign of the weighted average of the spillover effects. This makes the bias from spillovers much more difficult to sign. 

To estimate treatment and spillover effects in the presence of spillovers and staggered treatment timing, I will propose an estimation strategy that follows the `imputation-based' approach proposed in concurrent work by \citet{Gardner_2021} and \citet{Borusyak_Jaravel_Spiess_2021} by incorporating spillovers directly into estimation similar to equations (\ref{eq:id_total}) and (\ref{eq:id_direct}). I assume I observe an independent and identically distributed panel for units $i$ and periods $t$. The imputation-based method relies on a model-based assumption for untreated and unexposed potential outcomes to formalize parallel trends:
\begin{assumption}[Parallel Counterfactual Trends (Staggered)]\label{assumption:parallel_staggered}
    For all units and all periods, the untreated and unexposed outcome is given by
    \begin{equation}\label{eq:y0_staggered}
        Y_{it}(0, \vec{0}) = \mu_i + \lambda_t + \varepsilon_{it},
    \end{equation}
    where $\expec{\varepsilon_{it}} = 0$, $\mu_i$ and $\lambda_t$ are non-stochastic unit and time fixed-effects.
\end{assumption}
This formalizes parallel trend by imposing that there is a common time-trend in the absence of treatment, $\lambda_t$. Note that this does not impose any structure on the effects of treatment and exposure $(D_{it}, h_i(\vec{D}))$. I also assume that units do not have any anticipatory effects before treatment starts:
\begin{assumption}[No Anticipation (Staggered)]\label{assumption:no-anticipation_staggered}
    For all observations with $D_{it} = 0$ and $h_i(\vec{D}) = 0$, $Y_{it}(D, \vec{h}) = Y_{it}(0,0)$ for all values of $D$ and $\vec{h}$.
\end{assumption}

With a model for $Y_{it}(0, \vec{0})$, treatment effects for individual $i$ and time $t$ under treatment status $D_{it}$ and exposure $h_i(\vec{D})$ are given by $\tau_{it}(D_{it}, h_i(\vec{D})) = Y_{it}(D_{it}, h_i(\vec{D})) - Y_{it}(0, \vec{0})$. Then, the total effect and the direct effect are formed similar to above:
\[
    \tau_{\text{total}} \equiv \expec{ \tau_{it}(1, h_i(\vec{D})) \ \vert \ D_{it} = 1} \text{ and }
    \tau_{\text{direct}} \equiv \expec{ \tau_{it}(1, 0) \ \vert \ D_{it} = 1, h_i(\vec{D}) = \vec{0}}.
\]
However, it is also common in event-study analyses to allow heterogeneity in effects by the number of years that a unit experiences treatment. Let $K_{it}$ denote the number of years since treatment turns on (-1 for the year prior, 0 for the initial year, and so on). Then we can define dummy variables $D_{it}^k \equiv D_{it} \one_{K_{it} = k}$ and estimate average total effects for each relative period: 
\[
    \tau_{\text{total}}^k \equiv \expec{ \tau_{it}(1, h_i(\vec{D})) \ \vert \ D_{it}^k = 1},
\]
and similarly for the direct effect.

Estimation of $\tau_{it}$ is the difference between the observed $Y_{it}$ and the unobserved outcome $Y_{it}(0, \vec{0})$ which we will estimate using observations with $D_{it} = 0$ and $h(\vec{D}, 0) = \vec{0}$. Similar to the previous section, under assumption (\ref{assumption:local}) we define $S_{it}$ to be an indicator equal to one if in period $t$, unit $i$ is within $\bar{d}$ distance from the nearest treated unit. Following the procedure laid out in \citet{Gardner_2021}, I propose a modified version of the two-stage difference-in-differences estimator: 

\begin{enumerate}
    \item Estimate $Y_{it} = \mu_i + \lambda_t + u_{it}$ for observations with $D_{it} = 0$ and $S_{it} = 0$ to estimate the common trend $\lambda_t$ and unit fixed-effects $\mu_i$. For all observations, residualize $\tilde{Y}_{it} \equiv Y_{it} - \hat{\mu}_i - \hat{\lambda}_t$ which is our estimate for $\tau_{it}$.
    
    \item Regress $\tilde{Y}_{it}$ on treatment and spillover dummy variables (discussed in table (\ref{tab:second_stage})).
\end{enumerate}

The first stage uses untreated and unexposed outcomes to estimate (\ref{eq:y0_staggered}). Then, $\tilde{Y}_{it}$ will serve as an estimate for $\tau_{it}$. The second stage estimates averages of $\tau_{it}$ for different groups depending on the parameters of interest. This is equivalent to regressing the residual $\tilde{Y}_{it}$ on dummy variable(s). Table \ref{tab:second_stage} provides examples of treatment effects of interest and corresponding dummy variables to include. 

% Table: Bias from Misspecification of Spillovers
\begin{table}[!tb]
    \caption{Second Stage Variables}
    \label{tab:second_stage}

    \centering
    \begin{threeparttable}
        \begin{tabular}{@{} *{2}{l} @{}}
            % Head
            \toprule
            \textbf{Estimand} & \textbf{Included Variables} \\

            % Body
            \midrule
            Total Effect & $D_{it}$ \\
            Total Effect (Event Study) & $D_{it}^k$ dummies \\
            Direct Effect & $D_{it}(1 - S_{it})$ \\
            Direct Effect (Event Study) & $D_{it}^k(1 - S_{it})$ dummies \\
            Spillover Effect on Control & $S_{it}(1 - D_{it})$ or $\text{Ring}_{it}(1-D_{it})$ \\
            Spillover Effect on Control (Event Study) & $S_{it}^k(1 - D_{it})$ or $\text{Ring}_{it}^k(1-D_{it})$ \\
            \bottomrule
        \end{tabular}
    \end{threeparttable}

\end{table}

As discussed in \citet{Gardner_2021}, inference must account for the fact that the regressand in the second stage is estimated in the first stage. \citet{Gardner_2021} propose reframing the two-stage process as a two-stage GMM estimator and discusses how to perform valid inference in this setting. This procedure is implemented in the R/Stata package \texttt{did2s} \citep{did2s}. 

In appendix section (\ref{sec:chc}), I use this two-stage estimator to revisit the analysis of \citet{Bailey_Goodman_Bacon_2015}. In particular, I find that the effects of community health centers stay within the county and therefore the originally estimated effects are robust. 

% ------------------------------------------------------------------------------
\section{Discussion}
\label{sec:conclusion}
% ------------------------------------------------------------------------------

This paper has considered the common environment where treatment is assigned via administrative boundary while the effects of treatment spread across these borders. I model this phenomenon in a potential outcomes framework and show why difference-in-differences estimation does not identify any treatment effect of interest. I then improve upon ad-hoc estimation strategies by proposing a new estimation strategy that is robust to more forms of spillovers. In particular, I find that specifications with an indicator for being ``close to'' treated units will remove all bias in the treatment effect estimate so long as all units affected by spillovers are contained in the indicator under a modified parallel trends assumption. More, I show that a set of concentric `rings' can remove all the bias and improve the estimation of spillover effects. A limitation of this research is in deciding how wide and how many rings to include in estimation. Concurrent work by \citet{Butts_2021} discusses data-driven ring selection under a more stringent parallel trends assumption that does not readily apply in the context of large geographic units such as counties. 

Then, I show that in settings with spatial spillovers, estimates can change significantly. In particular, place-based interventions change the nature of agglomeration in the local and surrounding area--that is cause spillovers--local effects of these policies can be misestimated without controlling for general equilibrium effects. I also show the importance of considering spillovers in weighing the pros and cons of various identification strategies. Identification strategies based on geographic continuity of unobservables can magnify the bias from spillovers as they restrict the comparison group to observations experiencing the largest spillover effects.


% ------------------------------------------------------------------------------
\setlength{\bibsep}{0.0pt}
\bibliography{references.bib}
% ------------------------------------------------------------------------------


% ------------------------------------------------------------------------------
\appendix 
\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}
\renewcommand{\thefigure}{\Alph{section}\arabic{figure}}
\renewcommand{\thetable}{\Alph{section}\arabic{table}}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\section{Proofs}
\label{sec:proofs}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\subsection{Proof of Proposition \ref{thm:bias}}
% ------------------------------------------------------------------------------

\begin{align*}
    &\underbrace{\expec{Y_{i1} - Y_{i0} \mid D_i = 1 } - \expec{Y_{i1} - Y_{i0} \mid D_i = 0 }}_{\text{Difference-in-Differences}} \\
    &= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0, \vec{0})  \mid D_i = 1 } - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i0}(0, \vec{0}) \mid D_i = 0 } \\
    &= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0, \vec{0})  \mid D_i = 1 } \\
    &\quad\quad - \expec{Y_{i1}(0, h_i(\vec{D})) + Y_{i1}(0, \vec{0}) - Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0}) \mid D_i = 0 } \\
    &= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0, \vec{0})  \mid D_i = 1 } - \expec{Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0}) \mid D_i = 0} \\ 
    &\quad\quad - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, \vec{0})\mid D_i = 0} \\ 
    &= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0, \vec{0})  \mid D_i = 1 } - \expec{Y_{i1}(0, \vec{0}) - Y_{i0}(0, \vec{0}) \mid D_i = 1} \\
    &\quad\quad - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, \vec{0})\mid D_i = 0} \\  
    &= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0, \vec{0}) - Y_{i1}(0, \vec{0}) + Y_{i0}(0, \vec{0})\mid D_i = 1 } \\
    &\quad\quad - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, \vec{0})\mid D_i = 0}\\
    &= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(0, \vec{0}) \mid D_i = 1 } - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, \vec{0})\mid D_i = 0}\\
    &= \expec{Y_{i1}(1, h_i(\vec{D})) + Y_{i1}(1, \vec{0}) - Y_{i1}(1, \vec{0}) - Y_{i1}(0, \vec{0})\mid D_i = 1 } \\
    &\quad\quad - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, \vec{0})\mid D_i = 0} \\
    &= \expec{Y_{i1}(1, \vec{0}) - Y_{i1}(0, \vec{0}) \mid D_i = 1} + \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(1, \vec{0}) \mid D_i = 1} \\
    &\quad\quad - \expec{Y_{i1}(0, h_i(\vec{D})) - Y_{i1}(0, \vec{0}) \mid D_i = 0} \\
    &\equiv \tau_{\text{direct}} + \tau_{\text{spill}}(1) - \tau_{\text{spill}}(0) = \tau_{\text{total}} - \tau_{\text{spill}}(0) \\
\end{align*}



% ------------------------------------------------------------------------------
\subsection{Proof of Proposition \ref{thm:remove_bias}}
% ------------------------------------------------------------------------------

For part (i):
\begin{align*}
    &\expec{Y_{i1} - Y_{i0} \ \mid \ D_i = 1} - \expec{Y_{i1} - Y_{i0} \ \mid \ D_i = 0, S_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0,0) \ \mid \ D_i = 1} - \expec{Y_{i1}(0, 0) - Y_{i0}(0,0) \ \mid \ D_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0,0) \ \mid \ D_i = 1} - \expec{Y_{i1}(0, 0) - Y_{i0}(0,0) \ \mid \ D_i = 1} \\
    &\quad\quad= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i0}(0,0) - Y_{i1}(0, 0) + Y_{i0}(0,0) \ \mid \ D_i = 1} \\
    &\quad\quad= \expec{Y_{i1}(1, h_i(\vec{D})) - Y_{i1}(0, 0) \ \mid \ D_i = 1} \\
    &\quad\quad\equiv \tau_{\text{total}},
\end{align*}
where the first equality comes from the fact that $S_i = 0$, the second equality from parallel trends assumption (\ref{assumption:parallel-mod}), and the last by definition of the total effect.

Similarly, for part (ii):
\begin{align*}
    &\expec{Y_{i1} - Y_{i0} \ \mid \ D_i = 1, S_i = 0} - \expec{Y_{i1} - Y_{i0} \ \mid \ D_i = 0, S_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, 0) - Y_{i0}(0,0) \ \mid \ D_i = 1, S_i = 0} - \expec{Y_{i1}(0, 0) - Y_{i0}(0,0) \ \mid \ D_i = 0, S_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, 0) - Y_{i0}(0,0) \ \mid \ D_i = 1, S_i = 0} - \expec{Y_{i1}(0, 0) - Y_{i0}(0,0) \ \mid \ D_i = 1, S_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, 0) - Y_{i0}(0,0) - Y_{i1}(0, 0) + Y_{i0}(0,0) \ \mid \ D_i = 1, S_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, 0) - Y_{i1}(0, 0) \ \mid \ D_i = 1, S_i = 0} \\
    &\quad\quad= \expec{Y_{i1}(1, 0) - Y_{i1}(0, 0) \ \mid \ D_i = 1} \\
    &\quad\quad\equiv \tau_{\text{direct}},
\end{align*}
where the first equality comes from the fact that $S_i = 0$, the second equality from parallel trends assumption (\ref{assumption:parallel-mod}) and 
the second to last equality follows from assumption (\ref{assumption:homogenous-direct}).

% ------------------------------------------------------------------------------
\section{Application on Opportunity Zones}\label{sec:oz}
% ------------------------------------------------------------------------------

In this section, I revist the analysis of \citet{Chen_Glaeser_Wessel_2021} on the 2017 Opportunity Zone program which created tax incentives for captial investment in targeted Census Tracts.\footnote{Concurrent work by \citet{Arefeva_2021} also estimates spillover to nearby opportunity zones using a different datset and finds positive spillover effects on nearby census tracts as well.} To measure the affects of the opportunity zone program on housing prices, the authors collect a panel of census tracts with a measure of housing prices from the Federal Housing Finance Agency (FHFA) from 2014-2019.\footnote{The index tries to create a consistent price index that captures for changes in the composition of homes that are sold over time.} They produce estimates using two different identification strategies.

First, they compare census tracts that were selected as Opportunity Zones to eligible, but ultimately not selected, census tracts. As discussed in Section \ref{sec:pbp}, this estimation strategy relies on the assumption that since these census tracts are similar in nature to the treated census tracts (both meeting the program's criteria), it is likely that home prices would continue on similar trajectories in the absence of the program. The authors run a standard two-way fixed effect specification on the subsample of eligible census tracts:
\begin{equation}\label{eq:oz-eligible}
    Y_{it} = \mu_i + \mu_t + \tau D_{it} + \varepsilon_{it},
\end{equation}
where $Y_{it}$ is the annual change in the home price index, $\mu_i$ are tract fixed-effects, $\mu_t$ are time fixed effects, and $D_{it}$ is an indicator for treatment. 

The second identification strategy relies on comparing selected census tracts to geographically neighboring census tracts. As discussed in Section \ref{sec:pbp}, this estimation strategy relies on the assumption that proximity of census tracts would face similar economic shocks and hence home prices would likely evolve in parallel. For each treated census tract, they find the nearest non-treated census tract to form a pair, $(i, \tilde{i}) \equiv \nu$. They then estimate the following equation:
\begin{equation}\label{eq:oz-neighbor}
    Y_{it} - Y_{\tilde{i}t}  = \mu_\nu + \tau D_{it} + u_{it},
\end{equation}
where $Y_{it}$ is the annual change in the home price index, $\mu_\nu$ are pair fixed-effects and $D_{it}$ is an indicator for treatment. 

In both cases, the authors provide evidence of parallel `pre-trends' as evidence supporting the respective underlying assumptions. The results of both estimation strategies are shown in Table \ref{tab:oz}. Column (1) and (2) show the results of estimating Equation (\ref{eq:oz-eligible}) and (\ref{eq:oz-neighbor}) respectively. The `not-selected' estimate finds a marginally significant effect of an increase in home prices of about 0.3\% annually while the `neighboring' estimate finds a strongly significant effect twice as large of about 0.65\%.\footnote{The authors use this estimate to rule out effects larger than $\approx 0.65 + 2 * 0.25 = 1.15\%$. As shown before, these estimates are biased upwards and hence the upper bound of effect size can be lowered to about $\approx 0.65\%$.} 

% Table: Effects of Opportunity Zones on Annual Home Price Growth
\begin{table}[!tb]
    \caption{Effects of Opportunity Zones on Annual Home Price Growth}
    \label{tab:oz}
    \renewcommand{\arraystretch}{1.1}

    \begin{adjustbox}{width = 0.8\textwidth, center}
        \begin{threeparttable}
            \begin{tabular}{@{} l ccc @{}}
                % Head
                \toprule

                & \multicolumn{1}{c}{\textbf{Not-Selected}} & \multicolumn{1}{c}{\textbf{Neighboring}} & \multicolumn{1}{c}{\textbf{Not-Selected and Neighboring}} \\ 
                \textit{Dependent Var.} & (1) & (2) & (3) \\
                
 
                % Body
                \midrule
                
                \input{../../tables/OZ_replication.tex}

                \bottomrule
            \end{tabular}
            
            % Notes 
            \begin{tablenotes}\footnotesize
                \item \textit{Notes.} This table contains estimation 
                \item $^{*} p< 0.1$; $^{**} p < 0.05$; $^{***} p < 0.01$.
            \end{tablenotes}
        \end{threeparttable}
    \end{adjustbox}
\end{table}

What is driving the differences in these estimates? As I proposed in section \ref{sec:pbp}, the differences could be due to the fact that neighboring units could be experiencing effects from the Opportunity Zones. To test this, I use the estimation strategy proposed in section \ref{sec:estimation} to modify equation \ref{eq:oz-eligible}. For the subsample of eligible census tracts, I run the following specification: 
\begin{equation}\label{eq:oz-spill}
    Y_{it} = \mu_i + \mu_t + \tau D_{it} + \gamma_{1} \text{Within 1/2mi.} +  \gamma_{2} \text{Within 1mi.} + \varepsilon_{it},
\end{equation}
where $\text{Within}$ are indicators for being within 1/2mi. and being between 1/2 and 1mi. from an Opportunity Zone. This estimation strategy uses non-neighboring census tracts as the effective control group and estimates effects for census tracts within or close to Opportunity Zones. The results are estimated in Table \ref{tab:oz} in Column (3). These estimated treatment effect decreased in this specification to 0.17\% and reveals that census tracts just outside of the Opportunity Zone experience negative and significant declines in home prices of about 1\%. This result explains why the estimated effect using the `neighbor' speficiation is twice as large as the `eligible' specification. 

The results of this section highlight the importance of considering spillovers when using "neighbor" style identification strategies, especially in settings where the unit of observation is small and spillover effects are quite likely. 


% ------------------------------------------------------------------------------
\section{Application on Community Health Centers}\label{sec:chc}
% ------------------------------------------------------------------------------

As an application of the above methods, I extend the analysis of \citet{Bailey_Goodman_Bacon_2015}. The authors study the creation of federal community health centers between 1965 and 1974 that provided \textit{primary} care to low-income communities. They test the hypothesis if access to low-/no-cost health care services decreased mortality rates on the treated population. To answer this question, the authors use a common event-study framework to compare outcomes in treated counties to all other US counties by estimating the following specification 
\begin{equation}\label{eq:chc_es}
    Y_{it} = \theta_i + X_{it} \beta + \sum_{k = -7}^{-2} \pi_y D_{it}^k + \sum_{k = 0}^{15} \tau_{y} D_{it}^k + \varepsilon_{it},
\end{equation}
where $D_i^k$ is the typical `event study' indicator for being treated for $k$ years, $\theta_i$ is county fixed-effects, and $X_{it}$ contains a set of controls.\footnote{Controls include 1960 county characteristic trends, state-year fixed-effects, and urban-group fixed-effects. A full list can be found on page 1080 of \citet{Bailey_Goodman_Bacon_2015}.} The coefficents $\pi_y$ can be interpreted as tests of parallel pre-trends and $\tau_y$ can be interepreted as the treatment effect of a community health center $y$ years after establishment. In years following the establishment of the community health centers, the authors find a reduction of between 15-30 deaths per 100,000 residents compared to a baseline adjusted mortality rate of 929 deaths per 100,000 residents. 

% Figure: Direct and Spillover Effects of Community Health Centers
\begin{figure}[tb!]
    \caption{Direct and Spillover Effects of Community Health Centers}
    \label{fig:chc_es_spill}
        
    {\centering
        \includegraphics[width=\textwidth]{../../figures/figure-chc-es_combined.pdf}
    }
    {\footnotesize
        \textit{Notes:} This figure plots event study estimates for the total effect and the spillover effect on control units within 25 miles of treatment at different periods relative to establishment year. The estimates are generated using the `did2s' package \citep{did2s}. 
    }
\end{figure}


There are theoretical reasons to think spillovers may or may not exist in this context. On the one hand, individuals outside the county can potentially travel to the community health centers to receive care. This would create a negative spillover effect on mortality rates in nearby counties which would bias their estimates towards zero. On the other hand, \citet{Bailey_Goodman_Bacon_2015} document evidence that their estimated effects are not due to emergencies but rather primary care services. In this case, it is less likely low-income individuals would travel very far to receive primary care, and hence the spillover effects are potentially near zero. My methodology can provide an answer to the question of how far do individuals travel for low-/no-cost primary care.

As in the method detailed above, I use an indicator for being within 25 miles of a treated county as the spillover variable. The results are presented in Figure \ref{fig:chc_es_spill}. The confidence intervals labeled with circles represent point estimates for the average spillover effect on control units within 25 miles. No spillover effect is estimated to be significantly different from zero which suggests that the effects of community health centers are very local. Since there are near zero spillover effects, the direct effect estimates marked in Figure \ref{fig:chc_es_spill} as diamonds maintain the same shape as the author's original estimates with estimates between 15-30 fewer deaths per 100,000 persons. 

The spillover effects results provide evidence that low-income individuals will not travel far to receive primary care. Practically, this suggests that community health centers should be targeted to be as accessible as possible for poor individuals as they are unable to travel far to access the services. 




% ------------------------------------------------------------------------------
\section{Monte Carlo Simulations}
% ------------------------------------------------------------------------------

% ------------------------------------------------------------------------------
\subsection{Bias Under Misspecification of Spillovers}
% ------------------------------------------------------------------------------

To illustrate the above discussion, I turn to a set of Monte Carlo simulations. The first exercise is to consider a set of different data generating processes and see how well estimates of the total effect perform when controlling for spillovers using potentially misspecified exposure mappings. In the general form, I generate data with unit and time fixed-effects and an error term that is uncorrelated with $D_{it}$ for many different exposure mappings $h_i(\vec{D})$. I generate data for unit $i$ is a US county at time $t \in \{1, \dots, 20\}$ using the following data-generating process:
\begin{equation}\label{eq:dgp_general}
    y_{it} = \lambda_t + \mu_i + 2 D_{it} + \beta_{\text{spill, control}} (1-D_{it}) h_i(\vec{D}) + \varepsilon_{it},
\end{equation}
where $\lambda_t \sim N(0.2t, 0.1^2)$ and $\mu_i \sim N(6, 2^2)$ respectively and the error term is IID and distributed as $\varepsilon_{it} \sim N(0, 2^2)$. For simplicity, I also remove spillovers onto treated units, but the results of which specifications perform best in the simulation are the same. to keep the magnitude of bias constant across specifications, I normalize the average spillover magnitude to be equal across specifications.\footnote{This results in a constant bias for TWFE estimates across data-generating processes.} For each true data-generating process, I estimate (\ref{eq:dgp_general}) with the correct spillover and misspecified alternatives $\tilde{h}(\vec{D}, i)$. 

The set of spillover specifications included in the data-generating process are `Within $40/80$mi.' which equals 1 if the counties' center of population is within $40/80$ miles to a treated counties center of population. This corresponds to different choices of $\bar{D}$ and hence $S_i$ in the text. `Within $40/80$mi. (Additive)' is the number of treated county's within $40/80$ miles of the control county. `Decay' is given by $\max_j D_j e^{-0.02 d(i,j)} * 1(d(i,j) < 80)$ and `Decay (Additive)' is given by $\sum_{j \neq i} D_j \exp^{-0.02 d(i,j)}$.

The last set of spillover specifications is commonly used in the literature as a semi-parametric estimator and are referred to as `Rings'. These consist of a set of indicators for falling within distance bins from the nearest treated unit (e.g. indicators for being between 0-20, 20-40, 40-60, and 60-80 miles to closest treated unit). The last specification is an additive version of `Rings' which is the number of treated units within each distance bin. This maintains a lot of the intuitive advantages of the `Rings' specification but parameterizes the spillovers to be additive in the number of nearby treated units. The advantage of this, as seen below, is enhanced performance of estimating spillover effects that are additive in nature. However, if the true specification is non-additive, then the additive specification no longer will remove all the bias from the direct effect estimate. Hence, if the direct effect is of principal concern, then the non-additive rings estimate is preferred.

% Table: Bias from Misspecification of Spillovers
\begin{table}[!tb]
    \caption{Bias from Misspecification of Spillovers}
    \label{tab:misspecification}
    \renewcommand\arraystretch{1}

    \begin{adjustbox}{width = 1.1\textwidth, center}
        \begin{threeparttable}
            \begin{tabular}{@{} l *{6}{d{2.4}} @{}}
                % Head
                \toprule
                & \multicolumn{6}{c}{Data-Generating Process} \\
                \cmidrule{2-7}

                & \mcl{\textbf{Within 40mi}} & \mcl{\textbf{Within 80mi}} & \mcl{\textbf{Within 40mi.}} & \mcl{\textbf{Within 80mi.}} & \mcl{\textbf{Decay}} & \mcl{\textbf{Decay}} \\
                Specification & & & \mcl{\textbf{(Additive)}} & \mcl{\textbf{(Additive)}} & & \mcl{\textbf{(Additive)}} \\
 
                % Body
                \midrule
                
                \input{../../tables/misspecification.tex}
                
                \\ \bottomrule
            \end{tabular}
            
            % Notes 
            \begin{tablenotes}\footnotesize
                \item \textit{Notes.} Each cell corresponds to the results from 1000 simulations of the data generating process specified by the column header and estimated by equation (\ref{eq:dgp_general}) with $\tilde{h}(\vec{D},i)$ given by the row label. The non-bracketed number represents the mean bias from the simulations and the bracketed number represents the mean square error given by $\sum_{i = 1}^n \frac{(\hat{\tau}_i - \tau_0)^2}{n}$
            \end{tablenotes}
        \end{threeparttable}
    \end{adjustbox}
\end{table}

The results of the simulations are produced in Table \ref{tab:misspecification}. For each entry in the table, the column label corresponds to the true exposure mapping used in the data-generating process and the row label corresponds to the exposure mapping, $\tilde{h}(\vec{D}, i)$, used in estimation.  The corresponding cell gives the mean bias from estimating equation (\ref{eq:dgp_general}) with the $\tilde{h}(\vec{D}, i)$ given by the row. The bracketed number below the mean bias is the mean-squared error of the estimate which is given by $\sum_{i=1}^n \frac{(\hat{\tau}_{i,\text{direct}} - \tau_0)^2}{n}$. The mean squared error combines the square of the bias term, the variance of the estimator, and the variance of the error term which does not depend on the equation specification. This measure gives a good sense of the trade-off with whether decreasing bias comes at the cost of increasing the variance of the estimator.

The first thing to note is that all specifications remove a large portion of the bias relative to traditional two-way fixed-effect estimates and lower the mean-squared error. In particular, correctly specifying the data-generating process removes almost all the bias in the direct effect estimate and greatly lowers the mean-squared error. The second result is that both the non-additive `Rings' and the `Within' specification perform best among all the misspecified spillovers in terms of removing bias, so long as they are wide enough to capture all the spillovers (see Proposition \ref{thm:remove_bias}). These specifications do so without increasing the variance of the estimator relative to the true specification. However, if the indicator is not wide enough as is the case with Within 40mi. for the 80mi. data-generating process, bias remains in the estimates. Therefore, if researchers are primarily interested in identifying the direct effect, then either `Rings' or `Within' specifications with a large cutoff distance are preferred.

% ------------------------------------------------------------------------------
\subsection{Spillover Effect Estimation}
% ------------------------------------------------------------------------------

Now, I turn to analyze how the specifications perform at estimating the spillover effects themselves. For the next table, I predict the spillover effect for each control unit from the point estimates on $\tilde{h}(\vec{D}, i)$. Then as a measure for how well spillovers are estimated, I will calculate one minus the mean squared prediction error normalized by the sum of squared spillovers (for comparison across data-generating processes), 
\begin{equation}\label{eq:mspe}
    1 - \frac{\sum_{i: D_i = 0} (\beta_{\text{spill, control}} h_i(\vec{D}) - \hat{\beta}_{\text{spill, control}} \tilde{h}(\vec{D}, i))^2}{\sum_{i: D_i = 0} (\beta_{\text{spill, control}} h_i(\vec{D}))^2}.
\end{equation} 
This will produce a percentage of spillovers that are explained by the specification, so numbers closer to $100\%$ represent better modeling of the spillovers. 

% Table: Percent of Spillovers Predicted by Specification
\begin{table}[!tb]
    \caption{Percent of Spillovers Predicted by Specification}
    \label{tab:misspecification_mspe}

    \begin{adjustbox}{width = 1.1\textwidth, center}
        \begin{threeparttable}
            \begin{tabular}{@{} l *{6}{d{2.2}} @{}}
                % Head
                \toprule
                & \multicolumn{6}{c}{Data-Generating Process} \\
                \cmidrule{2-7}

                & \mcl{\textbf{Within 40mi}} & \mcl{\textbf{Within 80mi}} & \mcl{\textbf{Within 40mi.}} & \mcl{\textbf{Within 80mi.}} & \mcl{\textbf{Decay}} & \mcl{\textbf{Decay}} \\
                Specification & & & \mcl{\textbf{(Additive)}} & \mcl{\textbf{(Additive)}} & & \mcl{\textbf{(Additive)}} \\
 
                % Body
                \midrule
                
                
                \input{../../tables/misspecification_mspe_percent.tex}
                
                \\ \bottomrule
            \end{tabular}
            
            % Notes 
            \begin{tablenotes}\footnotesize
                \item \textit{Notes.} Each cell corresponds to the results from 1000 simulations of the data generating process specified by the column header and estimated by equation (\ref{eq:dgp_general}) with $\tilde{h}(\vec{D},i)$ given by the row label. The number corresponds to the mean square prediction error of the spillover effect for each control unit normalized by the total variance of spillover effects, given by Equation \ref{eq:mspe}.
            \end{tablenotes}
        \end{threeparttable}
    \end{adjustbox}
\end{table}

Results of this exercise are presented in Table \ref{tab:misspecification_mspe}. For each specification, correctly specifying the spillovers produces the best estimates for spillovers as expected. Among misspecified exposure mapping, a `Rings' specification that is large enough to capture all the spillovers perform better than all other specifications in all non-additive data-generating processes. On the other hand, when the spillovers are additive, the predicted spillovers from the non-additive ring specifications do not as accurately measure these spillovers as they did before.\footnote{Although the non-additive Rings do estimate between 70\% and 80\% of the spillover effects while maintaining complete removal of bias.} Non-additive specifcations perform somewhat poorly at estimating spillovers in the additive data-generating processes, `Within (Additive)' and `Decay (Additive)'. The `Rings (Additive)' specification successfully predicts spillovers in both additive data-generating processes. 

\end{document}
